# Логика игры "Save Oneself"

## Общее описание
"Save Oneself" - это карточная стратегическая игра, где игрок пытается выжить на острове и привлечь внимание проходящего корабля. Игра проходит на сетке с ограничением в 4 уникальных ряда и 4 уникальных столбца.

## Основные компоненты

### Карты
Игра использует два типа карт:
1. **Карты тыльной стороны** (`INITIAL_DECK`):
   - Содержат базовые ресурсы и инструменты
   - Имеют требования для переворота
   - Могут указывать направление для размещения корабля
   - Каждая карта имеет:
     - `lives` - количество жизней, которые даёт карта
     - `direction` - направление для корабля (NE, NW, SE, SW)
     - `id` - уникальный идентификатор
     - `requirements` - требования для переворота
     - `type` - тип карты ('back')
     - `emoji` - эмодзи для визуального отображения

2. **Карты лицевой стороны** (`INITIAL_FRONT_DECK`):
   - Открываются при выполнении требований
   - Представляют собой улучшенные версии базовых карт
   - Имеют:
     - `lives` - количество дополнительных жизней
     - `backId` - связь с картой тыльной стороны
     - `id` - уникальный идентификатор
     - `type` - тип карты ('front')
     - `emoji` - эмодзи для визуального отображения
     - `score` - очки, которые даёт карта при подсчёте финального результата

### Корабль
- Специальная карта, которая появляется при размещении карты с направлением
- Размещается в одном из четырёх углов относительно игрового поля
- Имеет свойство `skipMove` для контроля движения
- Имеет `cornerCoordinates` для определения границ игрового поля
- Имеет `hasTurned` для отслеживания поворотов при наличии карты 'ship-sighted'
- Ключевой элемент для победы

## Игровые фазы
Игра разделена на несколько фаз, которые циклически повторяются:

1. **Начало раунда**:
   - Сброс флагов `hasPlacedCard` и `hasMoved`
   - Определение количества доступных ходов (2 если есть карта 'compass', иначе 1)

2. **Фаза перемещения**:
   - Игрок может перемещаться на соседние клетки
   - При перемещении на пустую клетку размещается новая карта из колоды
   - Срабатывают эффекты карт при размещении и перемещении
   - Уменьшается количество оставшихся ходов
   - Проверяются условия победы и поражения

3. **Проверка шторма** (при размещении 13-й карты):
   - Автоматически переворачивается карта шторма, если она есть на поле

4. **Фаза уменьшения жизней**:
   - Автоматически уменьшает количество жизней на 1
   - Проверяются условия поражения при нулевых жизнях

5. **Фаза переворота карт**:
   - Игрок может переворачивать карты при выполнении требований
   - Проверяются все условия для переворота
   - Можно пропустить фазу

6. **Фаза движения корабля**:
   - Корабль двигается в соответствии со своим направлением
   - Длится 500мс
   - Проверяются условия победы и поражения
   - После завершения возвращается к началу раунда

## Механики

### Размещение карт
- Карты размещаются на пустых клетках сетки
- Ограничения:
  - Максимум 4 уникальных ряда и 4 уникальных столбца
  - Позиция должна быть валидной относительно корабля
  - Должна соседствовать с позицией игрока
  - В один раунд можно разместить только одну карту

### Переворот карт
Карту можно перевернуть, если:
- Это карта тыльной стороны
- Выполнены все требования
- Текущая фаза - фаза переворота

Требования для переворота:
- Наличие определённой карты на поле
- Для карты с `_ship-set-sail` - корабль есть на поле и в состоянии skipMove = true
- Для карты 'higher-ground' - игрок должен находиться на карте 'higher-ground'
- Для карты с требованием '_map' - игрок должен находиться на пересечении рядов карт 'map-r' и 'map-c'

### Движение
- Игрок может перемещаться на соседние клетки
- При перемещении на пустую клетку размещается новая карта
- Проверяются все ограничения размещения
- Позиция игрока важна для некоторых механик

### Победа
Игрок побеждает, если:
- На поле есть перевёрнутая карта 'sos' И корабль находится в том же ряду
- ИЛИ
- На поле есть перевёрнутая карта 'lit-beacon' И корабль находится в том же столбце
- ИЛИ
- На поле есть перевёрнутая карта 'message' И корабль находится на соседней клетке (не в углу)

### Поражение
Игрок проигрывает, если:
- Количество жизней достигло нуля
- Корабль уплыл слишком далеко от игрового поля
- Колода карт закончилась

## Состояние игры
- `lives` - количество жизней (максимум 16)
- `occupiedPositions` - карта занятых позиций
- `playerPosition` - текущая позиция игрока
- `deck` - колода карт тыльной стороны
- `frontDeck` - колода карт лицевой стороны
- `shipCard` - информация о корабле
- `hasPlacedCard` - флаг размещения карты в текущем раунде
- `movesLeft` - количество оставшихся ходов
- `hasMoved` - флаг перемещения в текущем раунде
- `gameOverMessage` - сообщение о завершении игры
- `isVictory` - флаг победы

## Подсчёт очков
Финальный счёт рассчитывается как сумма:
- Очков от перевёрнутых карт (если у карты есть свойство `score`)
- Оставшихся жизней
- Бонусных очков (1 очко за каждые 4 размещённые карты) 