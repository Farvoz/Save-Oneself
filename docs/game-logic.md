# Логика игры Marooned

## Общее описание
Marooned - это карточная стратегическая игра, где игрок пытается выжить на острове и привлечь внимание проходящего корабля. Игра проходит на сетке 9x9 (от -4 до 4 по обеим осям).

## Основные компоненты

### Карты
Игра использует два типа карт:
1. **Карты тыльной стороны** (`deck`):
   - Содержат базовые ресурсы и инструменты
   - Имеют требования для переворота
   - Могут указывать направление для размещения корабля
   - Каждая карта имеет:
     - `lives` - количество жизней, которые даёт карта
     - `direction` - направление для корабля (NE, NW, SE, SW)
     - `id` - уникальный идентификатор
     - `requirements` - требования для переворота
     - `type` - тип карты ('back')
     - `emoji` - эмодзи для визуального отображения

2. **Карты лицевой стороны** (`frontDeck`):
   - Открываются при выполнении требований
   - Представляют собой улучшенные версии базовых карт
   - Имеют:
     - `lives` - количество дополнительных жизней
     - `backId` - связь с картой тыльной стороны
     - `id` - уникальный идентификатор
     - `type` - тип карты ('front')
     - `emoji` - эмодзи для визуального отображения

### Корабль
- Специальная карта, которая появляется при размещении карты с направлением
- Размещается в одном из четырёх углов относительно игрового поля
- Имеет свойство `skipMove` для контроля движения
- Ключевой элемент для победы

## Игровые фазы
Игра разделена на 4 фазы, которые циклически повторяются:

1. **Фаза размещения** (1):
   - Игрок выбирается направление, куда пойдет
   - Если в выбранном направлении нет карт, то Игрок размещает новую карту из колоды
   - Срабатывают события появлении карты: Карта даёт жизни или Может активировать появление корабля

2. **Фаза уменьшения жизней** (2):
   - Автоматически уменьшает количество жизней
   - Длится 500мс

3. **Фаза переворота** (3):
   - Игрок может переворачивать карты при выполнении требований
   - Проверяются все условия для переворота
   - Если доступных карт для переворота нет, то автоматически игра переходит в следующую фазу 4

4. **Фаза движения корабля** (4):
   - Корабль пытается двигаться
   - Длится 1000мс
   - После завершения возвращается к фазе 1

## Механики

### Размещение карт
- Карты размещаются на пустых клетках сетки
- Ограничения:
  - Максимум 4 уникальных ряда и 4 уникальных столбца
  - Позиция должна быть валидной относительно корабля
  - Должна соседствовать с позицией игрока

### Переворот карт
Карту можно перевернуть, если:
- Это карта тыльной стороны
- Выполнены все требования
- Текущая фаза - 3

Требования для переворота:
- Наличие определённой карты на поле
- Для карты с `_ship-set-sail` - корабль есть на поле и в состоянии skipMove = true

### Движение
- Игрок может перемещаться на пустые клетки
- Игрок может перемещаться на уже размещенные клетки
- Проверяются все ограничения размещения
- Позиция игрока важна для некоторых механик

### Победа
Игрок побеждает, если:
- На поле есть перевёрнутая карта 'sos' И корабль находится в том же ряду
- ИЛИ
- На поле есть перевёрнутая карта 'lit-beacon' И корабль находится в том же столбце

## Состояние игры
- `lives` - количество жизней (максимум 16)
- `occupiedPositions` - карта занятых позиций
- `playerPosition` - текущая позиция игрока
- `currentPhase` - текущая фаза игры
- `isPhaseTransitioning` - технический флаг перехода между фазами

## События
Игра использует систему событий для обновления UI:
- `gameStateChanged` - изменение состояния игры
- `cardPlaced` - размещение карты
- `shipPlaced` - размещение корабля
- `phaseChanged` - смена фазы
- `cardFlipped` - переворот карты
- `playerMoved` - перемещение игрока 