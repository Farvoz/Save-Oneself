<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ä—Ç–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }

        #game-container {
            position: relative;
            width: 595px;  /* 7 * 85px - step */
            height: 595px; /* 7 * 85px - step */
            margin: 20px;
            border: 2px solid #333;
            background-color: white;
            display: grid;
            grid-template-columns: repeat(7, 85px);
            grid-template-rows: repeat(7, 85px);
        }

        .grid-cell {
            width: 85px;
            height: 85px;
            border: 1px solid #ccc;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #666;
            box-sizing: border-box;
        }

        .grid-cell.coordinate {
            font-weight: bold;
            color: #333;
        }

        .card {
            position: absolute;
            width: 75px;
            height: 75px;
            background-color: #F5F5DC;
            border: 2px solid #E8E8D0;
            border-radius: 8px;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: black;
            z-index: 2;
            /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –≤ —è—á–µ–π–∫–µ */
            left: 5px;  /* (85px - 75px) / 2 */
            top: 5px;   /* (85px - 75px) / 2 */
        }

        .card-lives {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 16px;
            color: #333;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        .card-name {
            font-size: 12px;
            margin-bottom: 2px;
            font-style: italic;
        }

        .card-direction {
            font-size: 8px;
            margin-top: 2px;
            position: absolute;
            left: 0;
            top: 0;
        }

        /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–µ–ª–æ–∫ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è */
        .ship-direction {
            font-size: 24px;
            margin: 2px 0;
            color: #333;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .ship-direction .pause-icon {
            font-size: 16px;
            margin-left: 4px;
        }

        .highlight {
            position: absolute;
            width: 75px;
            height: 75px;
            /* —Å–¥–µ–ª–∞—Ç—å —Å–≤–µ—Ç–ª–æ-—Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π */
            background-color: #fffff3;
            border: 2px dashed #FFC107;
            border-radius: 8px;
            cursor: pointer;
            opacity: 0.8;
            z-index: 1;
            /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –≤ —è—á–µ–π–∫–µ */
            left: 5px;  /* (85px - 75px) / 2 */
            top: 5px;   /* (85px - 75px) / 2 */
        }

        .highlight:hover {
            transform: scale(1.1);
            opacity: 1;
        }

        #counters {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }

        .counter {
            font-size: 24px;
            color: #333;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            display: none;
            font-size: 24px;
            z-index: 3;
        }
    </style>
</head>
<body>
    <div id="counters">
        <div class="counter">‚ù§Ô∏è –ñ–∏–∑–Ω–∏: <span id="lives">16</span></div>
        <div class="counter">üÉè –ö–∞—Ä—Ç—ã: <span id="cards-left">15</span></div>
    </div>
    <div id="game-container"></div>
    <div id="game-over"></div>

    <script>
        const container = document.getElementById('game-container');
        const livesCounter = document.getElementById('lives');
        const cardsCounter = document.getElementById('cards-left');
        const gameOverDiv = document.getElementById('game-over');
        
        let lives = 17;
        let occupiedPositions = new Map(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º Map –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π

        // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∫–æ—Ä–∞–±–ª—è
        const shipCard = {
            type: 'ship',
            lives: 0,
            direction: undefined,
            id: 'ship',
            requirements: '',
            position: undefined,
            skipMove: true,  // –§–ª–∞–≥ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è
            moves: 0,        // –°—á–µ—Ç—á–∏–∫ —à–∞–≥–æ–≤ –∫–æ—Ä–∞–±–ª—è
            emoji: '‚õµ'      // –≠–º–æ–¥–∂–∏ –¥–ª—è –∫–æ—Ä–∞–±–ª—è
        };
        
        let deck = [
            { lives: 0, direction: 'NE', id: 'hook', requirements: 'water', type: 'back', emoji: 'üé£' },
            { lives: 2, direction: '', id: 'water', requirements: 'telescope', type: 'back', emoji: 'üíß' },
            { lives: 0, direction: '', id: 'flint', requirements: 'vines', type: 'back', emoji: '‚ö°' },
            { lives: 0, direction: 'SW', id: 'vines', requirements: 'palm-trees', type: 'back', emoji: 'üåø' },
            { lives: 0, direction: 'SE', id: 'palm-trees', requirements: 'rocks', type: 'back', emoji: 'üå¥' },
            { lives: 0, direction: 'NW', id: 'sticks', requirements: 'flint', type: 'back', emoji: 'ü™µ' },
            // –ù—É–∂–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –≤–æ–∑–≤—ã—à–µ–Ω–Ω–æ—Å—Ç–∏
            { lives: 0, direction: '', id: 'telescope', requirements: 'higher-ground', type: 'back', emoji: 'üî≠' },
            { lives: 0, direction: '', id: 'rocks', requirements: 'higher-ground', type: 'back', emoji: 'ü™®' },
            // –û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
            { lives: 0, direction: '', id: 'higher-ground', requirements: 'torch', type: 'back', emoji: '‚õ∞Ô∏è' },
            // –û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –æ—Ç –∫–æ—Ä–∞–±–ª—è
            { lives: 0, direction: '', id: 'bottle', requirements: '_ship-set-sail', type: 'back', emoji: 'üçæ' },
        ];

        let cards = deck.length - 1;

        // —Å–¥–µ–ª–∞—Ç—å –Ω–∞–±–æ—Ä –∫–∞—Ä—Ç –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
        let deckBack = [
            { lives: 3, backId: 'hook', id: 'fish', type: 'front', emoji: 'üêü' },
            { lives: 2, backId: 'water', id: 'waterfall', type: 'front', emoji: 'üåä' },
            { lives: 0, backId: 'flint', id: 'torch', type: 'front', emoji: 'üî•' },
            { lives: 2, backId: 'palm-trees', id: 'coconuts', type: 'front', emoji: 'ü••' },
            { lives: 0, backId: 'sticks', id: 'spear', type: 'front', emoji: 'üó°Ô∏è' },
            // –û—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞: –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —É—Ä–æ–Ω–∞ —à—Ç–æ—Ä–º–∞
            { lives: 2, backId: 'vines', id: 'shelter', type: 'front', emoji: 'üè†' },
            // –≠—Ç–∞ –∫–∞—Ä—Ç–∞ –º–µ–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∫–æ—Ä–∞–±–ª–µ–π. –û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
            { lives: 0, backId: 'telescope', id: 'ship-sighted', type: 'front', emoji: 'üö¢' },
              // –ö–∞—Ä—Ç–∞ —Å–ø–∞—Å–∞–µ—Ç —Å –æ—Å—Ç—Ä–æ–≤–∞. –ù—É–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å —Ä—è–¥
            { lives: 0, backId: 'rocks', id: 'sos', type: 'front', emoji: 'üÜò' },
            // –ö–∞—Ä—Ç–∞ —Å–ø–∞—Å–∞–µ—Ç —Å –æ—Å—Ç—Ä–æ–≤–∞. –ù—É–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–ª–æ–Ω–∫—É
            { lives: 0, backId: 'higher-ground', id: 'lit-beacon', type: 'front', emoji: 'üèÆ' },
            // –ö–∞—Ä—Ç–∞ —Å–ø–∞—Å–∞–µ—Ç —Å –æ—Å—Ç—Ä–æ–≤–∞: –µ—Å–ª–∏ –∫–æ—Ä–∞–±–ª—å –ø—Ä–æ–ø–ª—ã–≤–∞–µ—Ç —Ä—è–¥–æ–º
            { lives: 0, backId: 'bottle', id: 'message', type: 'front', emoji: 'üìú' },
        ];

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –ø–æ–ª—è—Ä–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ –¥–µ–∫–∞—Ä—Ç–æ–≤—ã
        function polarToCartesian(row, col) {
            const startX = 0;  // –¢–µ–ø–µ—Ä—å –Ω–∞—á–∏–Ω–∞–µ–º —Å 0, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º grid
            const startY = 0;  // –¢–µ–ø–µ—Ä—å –Ω–∞—á–∏–Ω–∞–µ–º —Å 0, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º grid
            return {
                x: startX + ((col + 3) * 85),  // +3 –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –æ—Ç -3 –¥–æ 3
                y: startY + ((row + 3) * 85)   // +3 –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –æ—Ç -3 –¥–æ 3
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–µ–∫–∞—Ä—Ç–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ –ø–æ–ª—è—Ä–Ω—ã–µ
        function cartesianToPolar(x, y) {
            const col = Math.round(x / 85) - 3;  // -3 –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –æ—Ç 0 –¥–æ -3
            const row = Math.round(y / 85) - 3;  // -3 –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –æ—Ç 0 –¥–æ -3
            return { row, col };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–∫–∏
        function createGrid() {
            // –°–æ–∑–¥–∞–µ–º 7x7 —Å–µ—Ç–∫—É (–¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ—Ç -3 –¥–æ 3)
            for (let row = -3; row <= 3; row++) {
                for (let col = -3; col <= 3; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —É–≥–ª–æ–≤—ã–µ —è—á–µ–π–∫–∏
                    if (Math.abs(row) === 3 || Math.abs(col) === 3) {
                        cell.classList.add('coordinate');
                        if (Math.abs(row) === 3 && Math.abs(col) === 3) {
                            cell.textContent = `${row},${col}`;
                        } else if (Math.abs(row) === 3) {
                            cell.textContent = col;
                        } else {
                            cell.textContent = row;
                        }
                    }
                    
                    container.appendChild(cell);
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            createGrid(); // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏–≥—Ä—ã
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–æ–ª–æ–¥—É
            deck.sort(() => Math.random() - 0.5);
            placeCard(0, 0); // –†–∞–∑–º–µ—â–∞–µ–º –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç—É –≤ [0,0]
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ—Ä–∞–±–ª—è. –ü–µ—Ä–µ–¥–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
        function createShipCard(row, col) {
            const coords = polarToCartesian(row, col);
            const card = document.createElement('div');
            card.className = 'card';
            card.setAttribute('data-position', `${row},${col}`);
            card.style.left = coords.x + 'px';
            card.style.top = coords.y + 'px';
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–µ–ª–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ø–∞—É–∑—É
            const directionDiv = document.createElement('div');
            directionDiv.className = 'ship-direction';
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–µ–ª–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const directionArrow = document.createElement('span');
            switch(shipCard.direction) {
                case 'NW': directionArrow.textContent = '‚û°Ô∏è'; break;
                case 'NE': directionArrow.textContent = '‚¨áÔ∏è'; break;
                case 'SW': directionArrow.textContent = '‚¨ÜÔ∏è'; break;
                case 'SE': directionArrow.textContent = '‚¨ÖÔ∏è'; break;
            }
            directionDiv.appendChild(directionArrow);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–∞—É–∑—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (shipCard.skipMove) {
                const pauseIcon = document.createElement('span');
                pauseIcon.className = 'pause-icon';
                pauseIcon.textContent = '‚è∏Ô∏è';
                directionDiv.appendChild(pauseIcon);
            }
            
            const nameDiv = document.createElement('div');
            nameDiv.textContent = `${shipCard.emoji} ${shipCard.id}`;
            nameDiv.style.fontSize = '12px';
            nameDiv.style.marginTop = '2px';
            nameDiv.style.fontStyle = 'italic';
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —à–∞–≥–æ–≤
            const movesDiv = document.createElement('div');
            movesDiv.textContent = `–®–∞–≥–∏: ${shipCard.moves}/5`;
            movesDiv.style.fontSize = '12px';
            movesDiv.style.marginTop = '2px';
            movesDiv.style.color = shipCard.moves >= 3 ? 'red' : 'inherit';
            card.appendChild(movesDiv);
            
            card.appendChild(nameDiv);
            card.appendChild(directionDiv);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –¥–ª—è –∫–æ—Ä–∞–±–ª—è
            card.style.backgroundColor = '#87CEEB';  // –≥–æ–ª—É–±–æ–π –¥–ª—è –∫–æ—Ä–∞–±–ª—è
            
            card.style.display = 'flex';
            card.style.flexDirection = 'column';
            card.style.alignItems = 'center';
            card.style.justifyContent = 'center';
            
            container.appendChild(card);
            occupiedPositions.set(`${row},${col}`, shipCard);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è —Ä—è–¥–æ–º —Å –∫–∞—Ä—Ç–æ–π
        function placeShip(direction) {
            if (shipCard.direction === direction) return;

            // –ù–∞—Ö–æ–¥–∏–º –∫—Ä–∞–π–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            let minRow = 0, maxRow = 0, minCol = 0, maxCol = 0;
            let shipRow, shipCol;

            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –∫–∞—Ä—Ç, –∏—Å–∫–ª—é—á–∞—è –∫–æ—Ä–∞–±–ª—å
            const cardPositions = Array.from(occupiedPositions.entries())
                .filter(([_, card]) => card !== shipCard)
                .map(([pos]) => pos.split(',').map(Number));

            if (cardPositions.length === 0) return;

            // –ù–∞—Ö–æ–¥–∏–º –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—è —Å –∫–∞—Ä—Ç–∞–º–∏
            cardPositions.forEach(([row, col]) => {
                minRow = Math.min(minRow, row);
                maxRow = Math.max(maxRow, row);
                minCol = Math.min(minCol, col);
                maxCol = Math.max(maxCol, col);
            });

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–æ—Ä–∞–±–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            switch(direction) {
                case 'NW':
                    shipRow = minRow - 1;
                    shipCol = minCol - 1;
                    break;
                case 'NE':
                    shipRow = minRow - 1;
                    shipCol = maxCol + 1;
                    break;
                case 'SW':
                    shipRow = maxRow + 1;
                    shipCol = minCol - 1;
                    break;
                case 'SE':
                    shipRow = maxRow + 1;
                    shipCol = maxCol + 1;
                    break;
            }

            shipCard.direction = direction;
            shipCard.position = `${shipRow},${shipCol}`;
            createShipCard(shipRow, shipCol);
            updateHighlights();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–±–µ–¥—ã
        function checkVictory() {
            // –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏–∏ –∫–∞—Ä—Ç sos –∏ lit-beacon
            let sosPosition = null;
            let beaconPosition = null;
            
            for (const [pos, card] of occupiedPositions) {
                if (card.type === 'front') {
                    if (card.id === 'sos') {
                        sosPosition = pos.split(',').map(Number);
                    } else if (card.id === 'lit-beacon') {
                        beaconPosition = pos.split(',').map(Number);
                    }
                }
            }
            
            // –ï—Å–ª–∏ –∫–æ—Ä–∞–±–ª—å –Ω–µ —Ä–∞–∑–º–µ—â–µ–Ω, –ø–æ–±–µ–¥—ã –Ω–µ—Ç
            if (!shipCard.position) return false;
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–æ—Ä–∞–±–ª—è
            const [shipRow, shipCol] = shipCard.position.split(',').map(Number);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –ø–æ–±–µ–¥—ã:
            // 1. –ö–æ—Ä–∞–±–ª—å –≤ —Ç–æ–º –∂–µ —Ä—è–¥—É, —á—Ç–æ –∏ sos
            // 2. –ö–æ—Ä–∞–±–ª—å –≤ —Ç–æ–π –∂–µ –∫–æ–ª–æ–Ω–∫–µ, —á—Ç–æ –∏ lit-beacon
            const sosVictory = sosPosition && shipRow === sosPosition[0];
            const beaconVictory = beaconPosition && shipCol === beaconPosition[1];
            
            return sosVictory || beaconVictory;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è
        function tryMoveShip() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–æ—Ä–∞–±–ª—å –Ω–∞ –ø–æ–ª–µ
            if (!shipCard.position) return;

            // –ï—Å–ª–∏ –∫–æ—Ä–∞–±–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –∏ –≤—ã—Ö–æ–¥–∏–º
            if (shipCard.skipMove) {
                shipCard.skipMove = false;
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ—Å—Ç–∏–≥ –ª–∏ –∫–æ—Ä–∞–±–ª—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞–≥–æ–≤
            if (shipCard.moves >= 5) {
                const gameOverText = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ö–æ—Ä–∞–±–ª—å —Å–æ–≤–µ—Ä—à–∏–ª 5 —à–∞–≥–æ–≤.';
                gameOverDiv.textContent = gameOverText;
                gameOverDiv.style.display = 'block';
                container.style.pointerEvents = 'none';
                return;
            }

            const [oldRow, oldCol] = shipCard.position.split(',').map(Number);
            let newRow = oldRow;
            let newCol = oldCol;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            switch(shipCard.direction) {
                case 'NW':
                    newCol++;
                    break;
                case 'NE':
                    newRow++; 
                    break;
                case 'SW':
                    newRow--;
                    break;
                case 'SE':
                    newCol--;
                    break;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ –∫–æ—Ä–∞–±–ª—å –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –ø–æ–ª—è
            if (newRow < -3 || newRow > 3 || newCol < -3 || newCol > 3) {
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–∞ –ª–∏ –Ω–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
            if (occupiedPositions.has(`${newRow},${newCol}`)) {
                return;
            }

            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —à–∞–≥–æ–≤
            shipCard.moves++;

            // –£–¥–∞–ª—è–µ–º –∫–æ—Ä–∞–±–ª—å —Å–æ —Å—Ç–∞—Ä–æ–π –ø–æ–∑–∏—Ü–∏–∏
            occupiedPositions.delete(shipCard.position);
            const oldCard = document.querySelector(`.card[data-position="${shipCard.position}"]`);
            if (oldCard) oldCard.remove();

            // –†–∞–∑–º–µ—â–∞–µ–º –∫–æ—Ä–∞–±–ª—å –Ω–∞ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
            createShipCard(newRow, newCol);
            shipCard.position = `${newRow},${newCol}`;
            updateHighlights();

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã
            if (checkVictory()) {
                let victoryText;
                const [shipRow, shipCol] = shipCard.position.split(',').map(Number);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–µ —É—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã —Å—Ä–∞–±–æ—Ç–∞–ª–æ
                for (const [pos, card] of occupiedPositions) {
                    if (card.type === 'front') {
                        const [cardRow, cardCol] = pos.split(',').map(Number);
                        if (card.id === 'sos' && shipRow === cardRow) {
                            victoryText = '–ü–æ–±–µ–¥–∞! –ö–æ—Ä–∞–±–ª—å –∑–∞–º–µ—Ç–∏–ª —Å–∏–≥–Ω–∞–ª SOS!';
                            break;
                        } else if (card.id === 'lit-beacon' && shipCol === cardCol) {
                            victoryText = '–ü–æ–±–µ–¥–∞! –ö–æ—Ä–∞–±–ª—å –∑–∞–º–µ—Ç–∏–ª –º–∞—è–∫!';
                            break;
                        }
                    }
                }
                
                gameOverDiv.textContent = victoryText;
                gameOverDiv.style.display = 'block';
                gameOverDiv.style.backgroundColor = 'rgba(0, 128, 0, 0.9)'; // –ó–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –ø–æ–±–µ–¥—ã
                container.style.pointerEvents = 'none';
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ö–æ–¥–∞
            if (shipCard.moves >= 5) {
                const gameOverText = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ö–æ—Ä–∞–±–ª—å —Å–æ–≤–µ—Ä—à–∏–ª 5 —à–∞–≥–æ–≤.';
                gameOverDiv.textContent = gameOverText;
                gameOverDiv.style.display = 'block';
                container.style.pointerEvents = 'none';
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        function addCard(row, col) {
            const coords = polarToCartesian(row, col);
            const card = document.createElement('div');
            card.className = 'card';
            card.setAttribute('data-position', `${row},${col}`);
            card.style.left = coords.x + 'px';
            card.style.top = coords.y + 'px';
            
            const cardObj = deck[deck.length - cards];
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
            const cardContent = document.createElement('div');
            cardContent.className = 'card-content';
            
            // –î–æ–±–∞–≤–ª—è–µ–º —á–∏—Å–ª–æ –∂–∏–∑–Ω–µ–π –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –¥–ª—è –∫–∞—Ä—Ç —Ç–∏–ø–∞ back –∏ front
            if (cardObj.lives > 0 && (cardObj.type === 'back' || cardObj.type === 'front')) {
                const livesDiv = document.createElement('div');
                livesDiv.className = 'card-lives';
                livesDiv.textContent = cardObj.lives;
                card.appendChild(livesDiv);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∂–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if (cardObj.id && cardObj.id !== '') {
                const nameDiv = document.createElement('div');
                nameDiv.className = 'card-name';
                nameDiv.textContent = `${cardObj.emoji} ${cardObj.id}`;
                cardContent.appendChild(nameDiv);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            if (cardObj.direction) {
                const directionDiv = document.createElement('div');
                directionDiv.className = 'card-direction';
                directionDiv.textContent = cardObj.direction;
                cardContent.appendChild(directionDiv);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–∞—Ä—Ç —Ç–∏–ø–∞ back
            if (cardObj.type === 'back' && cardObj.requirements) {
                const requirementsDiv = document.createElement('div');
                requirementsDiv.className = 'card-requirements';
                requirementsDiv.style.fontSize = '10px';
                requirementsDiv.style.color = '#666';
                requirementsDiv.style.fontStyle = 'italic';
                requirementsDiv.style.marginTop = '2px';
                requirementsDiv.style.textAlign = 'center';
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
                let requirementsText = '';
                if (cardObj.requirements === '_ship-set-sail') {
                    requirementsText = '–Ω—É–∂–µ–Ω –∫–æ—Ä–∞–±–ª—å –Ω–∞ –ø–∞—É–∑–µ';
                } else {
                    requirementsText = `–Ω—É–∂–Ω–∞ ${cardObj.requirements}`;
                }
                requirementsDiv.textContent = requirementsText;
                cardContent.appendChild(requirementsDiv);
            }
            
            card.appendChild(cardContent);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–∞—Ä—Ç—ã
            if (cardObj === shipCard) {
                // –ö–æ—Ä–∞–±–ª—å - –≥–æ–ª—É–±–æ–π
                card.style.backgroundColor = '#87CEEB';
            } else if (cardObj.type === 'back') {
                // –û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ - –±–µ–∂–µ–≤—ã–π
                card.style.backgroundColor = '#F5F5DC';
            } else if (cardObj.type === 'front') {
                // –õ–∏—Ü–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ - —Å–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π
                card.style.backgroundColor = '#E8F5E9';
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –∫–∞—Ä—Ç —Ç–∏–ø–∞ back
            if (cardObj.type === 'back') {
                card.style.cursor = 'pointer';
                card.addEventListener('click', () => tryFlipCard(row, col));
            }
            
            container.appendChild(card);
            
            occupiedPositions.set(`${row},${col}`, cardObj);
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –µ—â–µ –Ω–µ —Ä–∞–∑–º–µ—â–µ–Ω –Ω–∏ –æ–¥–∏–Ω –∫–æ—Ä–∞–±–ª—å, —Ä–∞–∑–º–µ—â–∞–µ–º –∫–æ—Ä–∞–±–ª—å
            if (cardObj.direction && ['NW', 'NE', 'SW', 'SE'].includes(cardObj.direction) && !shipCard.direction) {
                placeShip(cardObj.direction);
            }
            
            updateHighlights();
            updateGameState();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –∫–∞—Ä—Ç—ã
        function canFlipCard(cardObj) {
            // –ï—Å–ª–∏ –∫–∞—Ä—Ç–∞ —É–∂–µ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞, –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å –æ–±—Ä–∞—Ç–Ω–æ
            if (cardObj.type === 'front') return false;
            
            // –ï—Å–ª–∏ —É –∫–∞—Ä—Ç—ã –µ—Å—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏—Ö
            if (cardObj.requirements) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–æ—Ä–∞–±–ª—è
                if (cardObj.requirements === '_ship-set-sail') {
                    return shipCard.direction === undefined;
                }
                
                // –ò—â–µ–º –∫–∞—Ä—Ç—É —Å —Ç—Ä–µ–±—É–µ–º—ã–º id —Å—Ä–µ–¥–∏ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—ã—Ö –∫–∞—Ä—Ç
                for (const [_, card] of occupiedPositions) {
                    if (card.id === cardObj.requirements) {
                        return true;
                    }
                }
                return false;
            }
            
            return true;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –∫–∞—Ä—Ç—ã
        function tryFlipCard(row, col) {
            const cardObj = occupiedPositions.get(`${row},${col}`);
            if (!cardObj || !canFlipCard(cardObj)) return;

            // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ä—Ç—É –≤ deckBack
            const frontCard = deckBack.find(card => card.backId === cardObj.id);
            if (!frontCard) return;

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç –∫–∞—Ä—Ç—ã
            cardObj.type = 'front';
            cardObj.id = frontCard.id;
            cardObj.lives = frontCard.lives;

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã
            const cardElement = document.querySelector(`.card[data-position="${row},${col}"]`);
            if (!cardElement) return;

            // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞—Ä—Ç—ã
            cardElement.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            const cardContent = document.createElement('div');
            cardContent.className = 'card-content';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∂–∏–∑–Ω–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if (cardObj.lives > 0) {
                const livesDiv = document.createElement('div');
                livesDiv.className = 'card-lives';
                livesDiv.textContent = cardObj.lives;
                cardElement.appendChild(livesDiv);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã —Å —ç–º–æ–¥–∂–∏
            const nameDiv = document.createElement('div');
            nameDiv.className = 'card-name';
            nameDiv.textContent = `${cardObj.emoji} ${cardObj.id}`;
            cardContent.appendChild(nameDiv);
            
            cardElement.appendChild(cardContent);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –∫–∞—Ä—Ç—ã –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–µ
            if (cardObj.type === 'front') {
                cardElement.style.backgroundColor = '#E8F5E9';  // —Å–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π –¥–ª—è –ª–∏—Ü–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
            }
            
            // –£–±–∏—Ä–∞–µ–º –∫—É—Ä—Å–æ—Ä pointer, —Ç–∞–∫ –∫–∞–∫ –∫–∞—Ä—Ç–∞ –±–æ–ª—å—à–µ –Ω–µ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞
            cardElement.style.cursor = 'default';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
            updateGameState();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
        function updateHighlights() {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É
            document.querySelectorAll('.highlight').forEach(el => el.remove());

            occupiedPositions.forEach((card, pos) => {
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –≤–æ–∫—Ä—É–≥ –∫–æ—Ä–∞–±–ª—è
                if (card === shipCard) return;

                const [row, col] = pos.split(',').map(Number);
                
                const directions = [
                    {dr: 0, dc: -1}, // left
                    {dr: 0, dc: 1},  // right
                    {dr: -1, dc: 0}, // top
                    {dr: 1, dc: 0}   // bottom
                ];

                directions.forEach(({dr, dc}) => {
                    const newRow = row + dr;
                    const newCol = col + dc;
                    
                    if (isValidPosition(newRow, newCol)) {
                        const coords = polarToCartesian(newRow, newCol);
                        const highlight = document.createElement('div');
                        highlight.className = 'highlight';
                        highlight.style.left = coords.x + 'px';
                        highlight.style.top = coords.y + 'px';
                        
                        highlight.addEventListener('click', () => {
                            if (lives > 0 && cards > 0) placeCard(newRow, newCol);
                        });
                        
                        container.appendChild(highlight);
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞—Ä—Ç –≤ —Ä—è–¥—É/–∫–æ–ª–æ–Ω–∫–µ
        function hasMaxRowsOrColumns(row, col) {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏, –∏—Å–∫–ª—é—á–∞—è –∫–æ—Ä–∞–±–ª—å
            const positions = Array.from(occupiedPositions.entries())
                .filter(([_, card]) => card !== shipCard)
                .map(([pos]) => pos.split(',').map(Number));
            positions.push([row, col]);
            
            const uniqueRows = [...new Set(positions.map(pos => pos[0]))];
            const uniqueCols = [...new Set(positions.map(pos => pos[1]))];
            
            return uniqueRows.length <= 4 && uniqueCols.length <= 4;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏
        function isValidPosition(row, col) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—è (4x4)
            if (row < -3 || row > 3 || col < -3 || col > 3) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–∞ –ª–∏ –ø–æ–∑–∏—Ü–∏—è
            if (occupiedPositions.has(`${row},${col}`)) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç –≤ —Ä—è–¥—É/–∫–æ–ª–æ–Ω–∫–µ
            if (!hasMaxRowsOrColumns(row, col)) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–∑–∏—Ü–∏—è —É–≥–ª–æ–≤–æ–π
            if (Math.abs(row) === 3 && Math.abs(col) === 3) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –∫–æ—Ä–∞–±–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            if (shipCard.direction) {
                // –ù–∞—Ö–æ–¥–∏–º –∫—Ä–∞–π–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
                let minRow = 3, maxRow = -3, minCol = 3, maxCol = -3;
                occupiedPositions.forEach((card, pos) => {
                    if (card.id === 'ship') return;

                    const [cardRow, cardCol] = pos.split(',').map(Number);
                    minRow = Math.min(minRow, cardRow);
                    maxRow = Math.max(maxRow, cardRow);
                    minCol = Math.min(minCol, cardCol);
                    maxCol = Math.max(maxCol, cardCol);
                });

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                switch(shipCard.direction) {
                    case 'NE': // –ù–µ–ª—å–∑—è –≤—ã—à–µ –∏ –ø—Ä–∞–≤–µ–µ
                        if (row < minRow || col > maxCol) return false;
                        break;
                    case 'SE': // –ù–µ–ª—å–∑—è –Ω–∏–∂–µ –∏ –ø—Ä–∞–≤–µ–µ
                        if (row > maxRow || col > maxCol) return false;
                        break;
                    case 'SW': // –ù–µ–ª—å–∑—è –Ω–∏–∂–µ –∏ –ª–µ–≤–µ–µ
                        if (row > maxRow || col < minCol) return false;
                        break;
                    case 'NW': // –ù–µ–ª—å–∑—è –≤—ã—à–µ –∏ –ª–µ–≤–µ–µ
                        if (row < minRow || col < minCol) return false;
                        break;
                }
            }
            
            return true;
        }

        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
        function placeCard(row, col) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–∞—Ä—Ç—ã –≤ –∫–æ–ª–æ–¥–µ
            if (cards <= 0) {
                const gameOverText = `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∫–∞—Ä—Ç—ã. –û—Å—Ç–∞–ª–æ—Å—å –∂–∏–∑–Ω–µ–π: ${lives}`;
                gameOverDiv.textContent = gameOverText;
                gameOverDiv.style.display = 'block';
                container.style.pointerEvents = 'none';
                return;
            }

            // –ù–∞ –∫–∞–∂–¥—ã–π —Ö–æ–¥:
            // 1. –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç—É (—Ç–∞–∫–∂–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç –≤ –∫–æ–ª–æ–¥–µ)
            const cardObj = deck[deck.length - cards];
            lives = lives + cardObj.lives;
            cards--;
            cardsCounter.textContent = cards;
            
            addCard(row, col);

            // 2. –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–µ–π
            decreaseLives();

            // 3. –°–¥–≤–∏–≥–∞–µ–º –∫–æ—Ä–∞–±–ª—å
            tryMoveShip();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
            updateHighlights();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
            if (lives <= 0 || shipCard.moves >= 5) {
                let gameOverText;
                if (lives <= 0) {
                    gameOverText = `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∂–∏–∑–Ω–∏. –í—ã–ª–æ–∂–µ–Ω–æ –∫–∞—Ä—Ç: ${deck.length - cards}`;
                } else {
                    gameOverText = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ö–æ—Ä–∞–±–ª—å —Å–æ–≤–µ—Ä—à–∏–ª 5 —à–∞–≥–æ–≤.';
                }
                gameOverDiv.textContent = gameOverText;
                gameOverDiv.style.display = 'block';
                container.style.pointerEvents = 'none';
            } else if (checkVictory()) {
                let victoryText;
                const [shipRow, shipCol] = shipCard.position.split(',').map(Number);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–µ —É—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã —Å—Ä–∞–±–æ—Ç–∞–ª–æ
                for (const [pos, card] of occupiedPositions) {
                    if (card.type === 'front') {
                        const [cardRow, cardCol] = pos.split(',').map(Number);
                        if (card.id === 'sos' && shipRow === cardRow) {
                            victoryText = '–ü–æ–±–µ–¥–∞! –ö–æ—Ä–∞–±–ª—å –∑–∞–º–µ—Ç–∏–ª —Å–∏–≥–Ω–∞–ª SOS!';
                            break;
                        } else if (card.id === 'lit-beacon' && shipCol === cardCol) {
                            victoryText = '–ü–æ–±–µ–¥–∞! –ö–æ—Ä–∞–±–ª—å –∑–∞–º–µ—Ç–∏–ª –º–∞—è–∫!';
                            break;
                        }
                    }
                }
                
                gameOverDiv.textContent = victoryText;
                gameOverDiv.style.display = 'block';
                gameOverDiv.style.backgroundColor = 'rgba(0, 128, 0, 0.9)'; // –ó–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –ø–æ–±–µ–¥—ã
                container.style.pointerEvents = 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∂–∏–∑–Ω–µ–π
        function decreaseLives() {
            lives = lives - 1;
            livesCounter.textContent = lives;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function updateGameState() {
            livesCounter.style.color = lives <= 5 ? 'red' : 'inherit';
            cardsCounter.style.color = cards <= 5 ? 'red' : 'inherit';
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        init();
    </script>
</body>
</html>
