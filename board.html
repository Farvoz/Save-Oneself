<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ä—Ç–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 800px;
            margin: 20px;
            border: 2px solid #333;
            background-color: white;
        }

        .card {
            position: absolute;
            width: 75px;
            height: 75px;
            background-color: #F5F5DC;
            border: 2px solid #E8E8D0;
            border-radius: 8px;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: black;
            z-index: 2;
        }

        .highlight {
            position: absolute;
            width: 75px;
            height: 75px;
            background-color: #FFEB3B;
            border: 2px dashed #FFC107;
            border-radius: 8px;
            cursor: pointer;
            opacity: 0.8;
            z-index: 1;
        }

        .highlight:hover {
            transform: scale(1.1);
            opacity: 1;
        }

        #counters {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .counter {
            font-size: 24px;
            color: #333;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            display: none;
            font-size: 24px;
            z-index: 3;
        }
    </style>
</head>
<body>
    <div id="counters">
        <div class="counter">‚ù§Ô∏è –ñ–∏–∑–Ω–∏: <span id="lives">16</span></div>
        <div class="counter">üÉè –ö–∞—Ä—Ç—ã: <span id="cards-left">15</span></div>
    </div>
    <div id="game-container"></div>
    <div id="game-over"></div>

    <script>
        const container = document.getElementById('game-container');
        const livesCounter = document.getElementById('lives');
        const cardsCounter = document.getElementById('cards-left');
        const gameOverDiv = document.getElementById('game-over');
        
        let lives = 16;
        let cards = 15;
        let occupiedPositions = {};
        const step = 85;
        
        // –°–æ–∑–¥–∞–µ–º –∫–æ–ª–æ–¥—É –∏–∑ –æ–±—ä–µ–∫—Ç–æ–≤-–∫–∞—Ä—Ç–æ—á–µ–∫
        const directions = ['NW', 'NE', 'SW', 'SE'];

        let deck = [
            { value: 0, direction: 'NE', id: 'hook', requirements: 'water' },
            { value: 1, direction: 'NW', id: '', requirements: '' },
            { value: 2, direction: 'SW', id: '', requirements: '' },
            { value: 3, direction: 'SE', id: '', requirements: '' },
            { value: 0, direction: '', id: '', requirements: '' },
            { value: 1, direction: '', id: '', requirements: '' },
            { value: 2, direction: '', id: '', requirements: '' },
            { value: 3, direction: '', id: '', requirements: '' },
            { value: 0, direction: '', id: '', requirements: '' },
            { value: 1, direction: '', id: '', requirements: '' },
            { value: 2, direction: '', id: '', requirements: '' },  
        ];

        // —Å–¥–µ–ª–∞—Ç—å –Ω–∞–±–æ—Ä –∫–∞—Ä—Ç –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
        let deckBack = [
            { value: 3, backId: 'hook', id: 'fish' },
            { value: 0, backId: '', id: '' },
            { value: 0, backId: '', id: '' },
            { value: 0, backId: '', id: '' },
            { value: 0, backId: '', id: '' },
            { value: 0, backId: '', id: '' },
            { value: 0, backId: '', id: '' },
            { value: 0, backId: '', id: '' },
            { value: 0, backId: '', id: '' },
        ];


        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            const startX = (container.offsetWidth - 75) / 2;
            const startY = (container.offsetHeight - 75) / 2;

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–æ–ª–æ–¥—É
            deck.sort(() => Math.random() - 0.5);
            addCard(startX, startY);

            updateHighlights();
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        function addCard(x, y) {
            const card = document.createElement('div');
            card.className = 'card';
            card.style.left = x + 'px';
            card.style.top = y + 'px';
            
            // –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∏–∑ –∫–æ–ª–æ–¥—ã
            const cardObj = deck[15 - cards];
            
            // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –Ω–∞–∑–≤–∞–Ω–∏—è
            const valueDiv = document.createElement('div');
            valueDiv.textContent = cardObj.value;
            valueDiv.style.fontSize = '24px';
            
            const directionDiv = document.createElement('div');
            directionDiv.textContent = cardObj.direction;
            directionDiv.style.fontSize = '14px';
            directionDiv.style.marginTop = '2px';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            if (cardObj.id && cardObj.id !== '') {
                const nameDiv = document.createElement('div');
                nameDiv.textContent = cardObj.id;
                nameDiv.style.fontSize = '12px';
                nameDiv.style.marginTop = '2px';
                nameDiv.style.fontStyle = 'italic';
                card.appendChild(nameDiv);
            }
            
            card.appendChild(valueDiv);
            card.appendChild(directionDiv);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è
            const colors = ['#FFB3BA', '#BAFFC9', '#BAE1FF', '#FFFFBA'];
            card.style.backgroundColor = colors[cardObj.value];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            card.style.display = 'flex';
            card.style.flexDirection = 'column';
            card.style.alignItems = 'center';
            card.style.justifyContent = 'center';
            
            container.appendChild(card);
            
            occupiedPositions[`${x},${y}`] = cardObj;
            updateGameState();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
        function updateHighlights() {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É
            document.querySelectorAll('.highlight').forEach(el => el.remove());

            // –ò—â–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
            Object.keys(occupiedPositions).forEach(pos => {
                const [x, y] = pos.split(',').map(Number);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ 4 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                const directions = [
                    {dx: -step, dy: 0}, // left
                    {dx: step, dy: 0},  // right
                    {dx: 0, dy: -step}, // top
                    {dx: 0, dy: step}   // bottom
                ];

                directions.forEach(({dx, dy}) => {
                    const newX = x + dx;
                    const newY = y + dy;
                    
                    if (isValidPosition(newX, newY)) {
                        const highlight = document.createElement('div');
                        highlight.className = 'highlight';
                        highlight.style.left = newX + 'px';
                        highlight.style.top = newY + 'px';
                        
                        highlight.addEventListener('click', () => {
                            if (lives > 0 && cards > 0) placeCard(newX, newY);
                        });
                        
                        container.appendChild(highlight);
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ 4 –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –ª—é–±–æ–π –∫–æ–ª–æ–Ω–∫–µ –∏–ª–∏ —Ä—è–¥—É
        function hasMaxRowsOrColumns(x, y) {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–Ω—è—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
            const positions = Object.keys(occupiedPositions).map(pos => pos.split(',').map(Number));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            positions.push([x, y]);
            
            // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ X –∏ Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            const uniqueX = [...new Set(positions.map(pos => pos[0]))];
            const uniqueY = [...new Set(positions.map(pos => pos[1]))];
            
            // –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö X –∏–ª–∏ Y –±–æ–ª—å—à–µ 4,
            // –∑–Ω–∞—á–∏—Ç –∫–∞—Ä—Ç–æ—á–∫—É –Ω–µ–ª—å–∑—è —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏
            return uniqueX.length <= 4 && uniqueY.length <= 4;
        }

        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏
        function isValidPosition(x, y) {
            return x >= 0 && x <= 725 && 
                   y >= 0 && y <= 725 &&
                   !occupiedPositions[`${x},${y}`] && hasMaxRowsOrColumns(x, y);
        }

        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
        function placeCard(x, y) {
            const cardObj = deck[15 - cards];
            lives -= (cardObj.value + 1); // –û—Ç–Ω–∏–º–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ + 1
            cards--;
            
            addCard(x, y);
            updateHighlights();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
            livesCounter.textContent = lives;
            cardsCounter.textContent = cards;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã
            if (lives <= 0 || cards <= 0) {
                const gameOverText = lives <= 0 ? 
                    `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∂–∏–∑–Ω–∏. –í—ã–ª–æ–∂–µ–Ω–æ –∫–∞—Ä—Ç: ${16 - cards}` : 
                    `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∫–∞—Ä—Ç—ã. –û—Å—Ç–∞–ª–æ—Å—å –∂–∏–∑–Ω–µ–π: ${lives}`;
                gameOverDiv.textContent = gameOverText;
                gameOverDiv.style.display = 'block';
                container.style.pointerEvents = 'none';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function updateGameState() {
            livesCounter.style.color = lives <= 5 ? 'red' : 'inherit';
            cardsCounter.style.color = cards <= 5 ? 'red' : 'inherit';
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        init();
    </script>
</body>
</html>
