<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ä—Ç–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 800px;
            margin: 20px;
            border: 2px solid #333;
            background-color: white;
        }

        .card {
            position: absolute;
            width: 75px;
            height: 75px;
            background-color: #F5F5DC;
            border: 2px solid #E8E8D0;
            border-radius: 8px;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: black;
            z-index: 2;
        }

        .highlight {
            position: absolute;
            width: 75px;
            height: 75px;
            background-color: #FFEB3B;
            border: 2px dashed #FFC107;
            border-radius: 8px;
            cursor: pointer;
            opacity: 0.8;
            z-index: 1;
        }

        .highlight:hover {
            transform: scale(1.1);
            opacity: 1;
        }

        #counters {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .counter {
            font-size: 24px;
            color: #333;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            display: none;
            font-size: 24px;
            z-index: 3;
        }
    </style>
</head>
<body>
    <div id="counters">
        <div class="counter">‚ù§Ô∏è –ñ–∏–∑–Ω–∏: <span id="lives">16</span></div>
        <div class="counter">üÉè –ö–∞—Ä—Ç—ã: <span id="cards-left">15</span></div>
    </div>
    <div id="game-container"></div>
    <div id="game-over"></div>

    <script>
        const container = document.getElementById('game-container');
        const livesCounter = document.getElementById('lives');
        const cardsCounter = document.getElementById('cards-left');
        const gameOverDiv = document.getElementById('game-over');
        
        let lives = 17;
        let cards = 16;
        let occupiedPositions = new Map(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º Map –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π
        const step = 85;

        // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∫–æ—Ä–∞–±–ª—è
        const shipCard = {
            lives: 0,
            direction: undefined,
            id: 'ship',
            requirements: '',
            position: undefined
        };
        
        // –°–æ–∑–¥–∞–µ–º –∫–æ–ª–æ–¥—É –∏–∑ –æ–±—ä–µ–∫—Ç–æ–≤-–∫–∞—Ä—Ç–æ—á–µ–∫
        const directions = ['NW', 'NE', 'SW', 'SE'];


        let deck = [
            { lives: 0, direction: 'NE', id: 'hook', requirements: 'water' },
            { lives: 0, direction: 'NW', id: '', requirements: '' },
            { lives: 0, direction: 'SW', id: 'telescope', requirements: '' },
            { lives: 0, direction: 'SE', id: '', requirements: '' },
            { lives: 2, direction: '', id: 'water', requirements: 'telescope' },
            { lives: 0, direction: '', id: '', requirements: '' },
            { lives: 0, direction: '', id: '', requirements: '' },
            { lives: 0, direction: '', id: '', requirements: '' },
            { lives: 0, direction: '', id: '', requirements: '' },
            { lives: 0, direction: '', id: '', requirements: '' },
            { lives: 0, direction: '', id: '', requirements: '' },  
        ];

        // —Å–¥–µ–ª–∞—Ç—å –Ω–∞–±–æ—Ä –∫–∞—Ä—Ç –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
        let deckBack = [
            { lives: 3, backId: 'hook', id: 'fish' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
        ];

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –ø–æ–ª—è—Ä–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ –¥–µ–∫–∞—Ä—Ç–æ–≤—ã
        function polarToCartesian(row, col) {
            const startX = (container.offsetWidth - 75) / 2;
            const startY = (container.offsetHeight - 75) / 2;
            return {
                x: startX + (col * step),
                y: startY + (row * step)
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–µ–∫–∞—Ä—Ç–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ –ø–æ–ª—è—Ä–Ω—ã–µ
        function cartesianToPolar(x, y) {
            const startX = (container.offsetWidth - 75) / 2;
            const startY = (container.offsetHeight - 75) / 2;
            const col = Math.round((x - startX) / step);
            const row = Math.round((y - startY) / step);
            return { row, col };
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            // const startX = (container.offsetWidth - 75) / 2;
            // const startY = (container.offsetHeight - 75) / 2;

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–æ–ª–æ–¥—É
            deck.sort(() => Math.random() - 0.5);
            placeCard(0, 0); // –†–∞–∑–º–µ—â–∞–µ–º –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç—É –≤ [0,0]

            // –ù–∞ –∫–∞–∂–¥—ã–π —Ö–æ–¥:
            // 1. –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç—É (—Ç–∞–∫–∂–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç –≤ –∫–æ–ª–æ–¥–µ)
            //      –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç
            // 2. –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–µ–π
            decreaseLives();
            // 3. –°–¥–≤–∏–≥–∞–µ–º –∫–æ—Ä–∞–±–ª—å
            moveShip();

            // 4. –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
            updateHighlights();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ—Ä–∞–±–ª—è
        function createShipCard(row, col) {
            const coords = polarToCartesian(row, col);
            const card = document.createElement('div');
            card.className = 'card';
            card.setAttribute('data-position', `${row},${col}`);
            card.style.left = coords.x + 'px';
            card.style.top = coords.y + 'px';
            
            const livesDiv = document.createElement('div');
            livesDiv.textContent = shipCard.lives;
            livesDiv.style.fontSize = '24px';
            
            const directionDiv = document.createElement('div');
            directionDiv.textContent = shipCard.direction;
            directionDiv.style.fontSize = '14px';
            directionDiv.style.marginTop = '2px';
            
            const nameDiv = document.createElement('div');
            nameDiv.textContent = shipCard.id;
            nameDiv.style.fontSize = '12px';
            nameDiv.style.marginTop = '2px';
            nameDiv.style.fontStyle = 'italic';
            
            card.appendChild(nameDiv);
            card.appendChild(livesDiv);
            card.appendChild(directionDiv);
            
            card.style.backgroundColor = '#87CEEB';
            card.style.display = 'flex';
            card.style.flexDirection = 'column';
            card.style.alignItems = 'center';
            card.style.justifyContent = 'center';
            
            container.appendChild(card);
            occupiedPositions.set(`${row},${col}`, shipCard);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è –≤ —É–≥–ª—É
        function placeShip(direction) {
            if (shipCard.direction === direction) return;

            let row, col;
            switch(direction) {
                case 'NW':
                    row = -3; col = -3;
                    break;
                case 'NE':
                    row = -3; col = 3;
                    break;
                case 'SW':
                    row = 3; col = -3;
                    break;
                case 'SE':
                    row = 3; col = 3;
                    break;
            }

            createShipCard(row, col);
            shipCard.direction = direction;
            shipCard.position = `${row},${col}`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è
        function moveShip() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–æ—Ä–∞–±–ª—å –Ω–∞ –ø–æ–ª–µ
            if (!shipCard.position) return;

            const [oldRow, oldCol] = shipCard.position.split(',').map(Number);
            let newRow = oldRow;
            let newCol = oldCol;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            switch(shipCard.direction) {
                case 'NW':
                    newCol++;
                    break;
                case 'NE':
                    newRow++; 
                    break;
                case 'SW':
                    newRow--;
                    break;
                case 'SE':
                    newCol--;
                    break;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ –∫–æ—Ä–∞–±–ª—å –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –ø–æ–ª—è
            if (newRow < -3 || newRow > 3 || newCol < -3 || newCol > 3) {
                return; // –ö–æ—Ä–∞–±–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥ –≥—Ä–∞–Ω–∏—Ü—ã
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–∞ –ª–∏ –Ω–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
            // if (occupiedPositions.has(`${newRow},${newCol}`)) {
            //     return; // –ö–æ—Ä–∞–±–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ, –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –∑–∞–Ω—è—Ç–∞
            // }

            // –£–¥–∞–ª—è–µ–º –∫–æ—Ä–∞–±–ª—å —Å–æ —Å—Ç–∞—Ä–æ–π –ø–æ–∑–∏—Ü–∏–∏
            occupiedPositions.delete(oldPos);
            const oldCard = document.querySelector(`.card[data-position="${oldPos}"]`);
            if (oldCard) oldCard.remove();

            // –†–∞–∑–º–µ—â–∞–µ–º –∫–æ—Ä–∞–±–ª—å –Ω–∞ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
            createShipCard(newRow, newCol);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        function addCard(row, col) {
            const coords = polarToCartesian(row, col);
            const card = document.createElement('div');
            card.className = 'card';
            card.setAttribute('data-position', `${row},${col}`);
            card.style.left = coords.x + 'px';
            card.style.top = coords.y + 'px';
            
            const cardObj = deck[16 - cards];
            
            const livesDiv = document.createElement('div');
            livesDiv.textContent = cardObj.lives;
            livesDiv.style.fontSize = '24px';
            
            const directionDiv = document.createElement('div');
            directionDiv.textContent = cardObj.direction;
            directionDiv.style.fontSize = '14px';
            directionDiv.style.marginTop = '2px';
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –µ—â–µ –Ω–µ —Ä–∞–∑–º–µ—â–µ–Ω –Ω–∏ –æ–¥–∏–Ω –∫–æ—Ä–∞–±–ª—å, —Ä–∞–∑–º–µ—â–∞–µ–º –∫–æ—Ä–∞–±–ª—å
            if (cardObj.direction && ['NW', 'NE', 'SW', 'SE'].includes(cardObj.direction) && !shipCard.direction) {
                placeShip(cardObj.direction);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            if (cardObj.id && cardObj.id !== '') {
                const nameDiv = document.createElement('div');
                nameDiv.textContent = cardObj.id;
                nameDiv.style.fontSize = '12px';
                nameDiv.style.marginTop = '2px';
                nameDiv.style.fontStyle = 'italic';
                card.appendChild(nameDiv);
            }
            
            card.appendChild(livesDiv);
            card.appendChild(directionDiv);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è
            const colors = ['#FFB3BA', '#BAFFC9', '#BAE1FF', '#FFFFBA'];
            card.style.backgroundColor = colors[cardObj.lives];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            card.style.display = 'flex';
            card.style.flexDirection = 'column';
            card.style.alignItems = 'center';
            card.style.justifyContent = 'center';
            
            container.appendChild(card);
            
            occupiedPositions.set(`${row},${col}`, cardObj);
            updateGameState();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
        function updateHighlights() {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É
            document.querySelectorAll('.highlight').forEach(el => el.remove());

            occupiedPositions.forEach((card, pos) => {
                const [row, col] = pos.split(',').map(Number);
                
                const directions = [
                    {dr: 0, dc: -1}, // left
                    {dr: 0, dc: 1},  // right
                    {dr: -1, dc: 0}, // top
                    {dr: 1, dc: 0}   // bottom
                ];

                directions.forEach(({dr, dc}) => {
                    const newRow = row + dr;
                    const newCol = col + dc;
                    
                    if (isValidPosition(newRow, newCol)) {
                        const coords = polarToCartesian(newRow, newCol);
                        const highlight = document.createElement('div');
                        highlight.className = 'highlight';
                        highlight.style.left = coords.x + 'px';
                        highlight.style.top = coords.y + 'px';
                        
                        highlight.addEventListener('click', () => {
                            if (lives > 0 && cards > 0) placeCard(newRow, newCol);
                        });
                        
                        container.appendChild(highlight);
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞—Ä—Ç –≤ —Ä—è–¥—É/–∫–æ–ª–æ–Ω–∫–µ
        function hasMaxRowsOrColumns(row, col) {
            const positions = Array.from(occupiedPositions.keys()).map(pos => pos.split(',').map(Number));
            positions.push([row, col]);
            
            const uniqueRows = [...new Set(positions.map(pos => pos[0]))];
            const uniqueCols = [...new Set(positions.map(pos => pos[1]))];
            
            return uniqueRows.length <= 4 && uniqueCols.length <= 4;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏
        function isValidPosition(row, col) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—è (4x4)
            if (row < -3 || row > 3 || col < -3 || col > 3) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–∞ –ª–∏ –ø–æ–∑–∏—Ü–∏—è
            if (occupiedPositions.has(`${row},${col}`)) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç –≤ —Ä—è–¥—É/–∫–æ–ª–æ–Ω–∫–µ
            if (!hasMaxRowsOrColumns(row, col)) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–∑–∏—Ü–∏—è —É–≥–ª–æ–≤–æ–π
            if (Math.abs(row) === 3 && Math.abs(col) === 3) return false;
            
            return true;
        }

        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
        function placeCard(row, col) {
            const cardObj = deck[16 - cards];
            lives = lives + cardObj.lives;
            cards--;
            
            addCard(row, col);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø–æ—Å–ª–µ –¥–≤–∏–∂–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª–µ–π
            updateHighlights();
            
            livesCounter.textContent = lives;
            cardsCounter.textContent = cards;

            if (lives <= 0 || cards <= 0) {
                const gameOverText = lives <= 0 ? 
                    `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∂–∏–∑–Ω–∏. –í—ã–ª–æ–∂–µ–Ω–æ –∫–∞—Ä—Ç: ${17 - cards}` : 
                    `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∫–∞—Ä—Ç—ã. –û—Å—Ç–∞–ª–æ—Å—å –∂–∏–∑–Ω–µ–π: ${lives}`;
                gameOverDiv.textContent = gameOverText;
                gameOverDiv.style.display = 'block';
                container.style.pointerEvents = 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∂–∏–∑–Ω–µ–π
        function decreaseLives() {
            lives = lives - 1;
            livesCounter.textContent = lives;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function updateGameState() {
            livesCounter.style.color = lives <= 5 ? 'red' : 'inherit';
            cardsCounter.style.color = cards <= 5 ? 'red' : 'inherit';
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        init();
    </script>
</body>
</html>
