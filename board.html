<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ä—Ç–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }

        #game-container {
            position: relative;
            width: 595px;  /* 7 * 85px - step */
            height: 595px; /* 7 * 85px - step */
            margin: 20px;
            border: 2px solid #333;
            background-color: white;
            display: grid;
            grid-template-columns: repeat(7, 85px);
            grid-template-rows: repeat(7, 85px);
        }

        .grid-cell {
            width: 85px;
            height: 85px;
            border: 1px solid #ccc;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #666;
            box-sizing: border-box;
        }

        .grid-cell.coordinate {
            font-weight: bold;
            color: #333;
        }

        .card {
            position: absolute;
            width: 75px;
            height: 75px;
            background-color: #F5F5DC;
            border: 2px solid #E8E8D0;
            border-radius: 8px;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: black;
            z-index: 2;
            /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –≤ —è—á–µ–π–∫–µ */
            left: 5px;  /* (85px - 75px) / 2 */
            top: 5px;   /* (85px - 75px) / 2 */
        }

        .highlight {
            position: absolute;
            width: 75px;
            height: 75px;
            background-color: #FFEB3B;
            border: 2px dashed #FFC107;
            border-radius: 8px;
            cursor: pointer;
            opacity: 0.8;
            z-index: 1;
            /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –≤ —è—á–µ–π–∫–µ */
            left: 5px;  /* (85px - 75px) / 2 */
            top: 5px;   /* (85px - 75px) / 2 */
        }

        .highlight:hover {
            transform: scale(1.1);
            opacity: 1;
        }

        #counters {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }

        .counter {
            font-size: 24px;
            color: #333;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            display: none;
            font-size: 24px;
            z-index: 3;
        }
    </style>
</head>
<body>
    <div id="counters">
        <div class="counter">‚ù§Ô∏è –ñ–∏–∑–Ω–∏: <span id="lives">16</span></div>
        <div class="counter">üÉè –ö–∞—Ä—Ç—ã: <span id="cards-left">15</span></div>
    </div>
    <div id="game-container"></div>
    <div id="game-over"></div>

    <script>
        const container = document.getElementById('game-container');
        const livesCounter = document.getElementById('lives');
        const cardsCounter = document.getElementById('cards-left');
        const gameOverDiv = document.getElementById('game-over');
        
        let lives = 17;
        let cards = 16;
        let occupiedPositions = new Map(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º Map –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π
        const step = 85;

        // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∫–æ—Ä–∞–±–ª—è
        const shipCard = {
            lives: 0,
            direction: undefined,
            id: 'ship',
            requirements: '',
            position: undefined,
            skipMove: true,  // –§–ª–∞–≥ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è
            moves: 0        // –°—á–µ—Ç—á–∏–∫ —à–∞–≥–æ–≤ –∫–æ—Ä–∞–±–ª—è
        };
        
        // –°–æ–∑–¥–∞–µ–º –∫–æ–ª–æ–¥—É –∏–∑ –æ–±—ä–µ–∫—Ç–æ–≤-–∫–∞—Ä—Ç–æ—á–µ–∫
        const directions = ['NW', 'NE', 'SW', 'SE'];


        let deck = [
            { lives: 0, direction: 'NE', id: 'hook', requirements: 'water' },
            { lives: 0, direction: 'NW', id: '', requirements: '' },
            { lives: 0, direction: 'SW', id: 'telescope', requirements: '' },
            { lives: 0, direction: 'SE', id: '', requirements: '' },
            { lives: 2, direction: '', id: 'water', requirements: 'telescope' },
            { lives: 0, direction: '', id: '', requirements: '' },
            { lives: 0, direction: '', id: '', requirements: '' },
            { lives: 0, direction: '', id: '', requirements: '' },
            { lives: 0, direction: '', id: '', requirements: '' },
            { lives: 0, direction: '', id: '', requirements: '' },
            { lives: 0, direction: '', id: '', requirements: '' },  
        ];

        // —Å–¥–µ–ª–∞—Ç—å –Ω–∞–±–æ—Ä –∫–∞—Ä—Ç –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
        let deckBack = [
            { lives: 3, backId: 'hook', id: 'fish' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
            { lives: 0, backId: '', id: '' },
        ];

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –ø–æ–ª—è—Ä–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ –¥–µ–∫–∞—Ä—Ç–æ–≤—ã
        function polarToCartesian(row, col) {
            const startX = 0;  // –¢–µ–ø–µ—Ä—å –Ω–∞—á–∏–Ω–∞–µ–º —Å 0, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º grid
            const startY = 0;  // –¢–µ–ø–µ—Ä—å –Ω–∞—á–∏–Ω–∞–µ–º —Å 0, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º grid
            return {
                x: startX + ((col + 3) * 85),  // +3 –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –æ—Ç -3 –¥–æ 3
                y: startY + ((row + 3) * 85)   // +3 –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –æ—Ç -3 –¥–æ 3
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–µ–∫–∞—Ä—Ç–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ –ø–æ–ª—è—Ä–Ω—ã–µ
        function cartesianToPolar(x, y) {
            const col = Math.round(x / 85) - 3;  // -3 –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –æ—Ç 0 –¥–æ -3
            const row = Math.round(y / 85) - 3;  // -3 –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –æ—Ç 0 –¥–æ -3
            return { row, col };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–∫–∏
        function createGrid() {
            // –°–æ–∑–¥–∞–µ–º 7x7 —Å–µ—Ç–∫—É (–¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ—Ç -3 –¥–æ 3)
            for (let row = -3; row <= 3; row++) {
                for (let col = -3; col <= 3; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —É–≥–ª–æ–≤—ã–µ —è—á–µ–π–∫–∏
                    if (Math.abs(row) === 3 || Math.abs(col) === 3) {
                        cell.classList.add('coordinate');
                        if (Math.abs(row) === 3 && Math.abs(col) === 3) {
                            cell.textContent = `${row},${col}`;
                        } else if (Math.abs(row) === 3) {
                            cell.textContent = col;
                        } else {
                            cell.textContent = row;
                        }
                    }
                    
                    container.appendChild(cell);
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            createGrid(); // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏–≥—Ä—ã
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–æ–ª–æ–¥—É
            deck.sort(() => Math.random() - 0.5);
            placeCard(0, 0); // –†–∞–∑–º–µ—â–∞–µ–º –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç—É –≤ [0,0]
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ—Ä–∞–±–ª—è
        function createShipCard(row, col) {
            const coords = polarToCartesian(row, col);
            const card = document.createElement('div');
            card.className = 'card';
            card.setAttribute('data-position', `${row},${col}`);
            card.style.left = coords.x + 'px';
            card.style.top = coords.y + 'px';
            
            const livesDiv = document.createElement('div');
            livesDiv.textContent = shipCard.lives;
            livesDiv.style.fontSize = '24px';
            
            const directionDiv = document.createElement('div');
            directionDiv.textContent = shipCard.direction;
            directionDiv.style.fontSize = '14px';
            directionDiv.style.marginTop = '2px';
            
            const nameDiv = document.createElement('div');
            nameDiv.textContent = shipCard.id;
            nameDiv.style.fontSize = '12px';
            nameDiv.style.marginTop = '2px';
            nameDiv.style.fontStyle = 'italic';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–ø—É—Å–∫–∞ —Ö–æ–¥–∞
            if (shipCard.skipMove) {
                const skipDiv = document.createElement('div');
                skipDiv.textContent = '‚è∏Ô∏è';
                skipDiv.style.fontSize = '12px';
                skipDiv.style.marginTop = '2px';
                card.appendChild(skipDiv);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —à–∞–≥–æ–≤
            const movesDiv = document.createElement('div');
            movesDiv.textContent = `–®–∞–≥–∏: ${shipCard.moves}/4`;
            movesDiv.style.fontSize = '12px';
            movesDiv.style.marginTop = '2px';
            movesDiv.style.color = shipCard.moves >= 3 ? 'red' : 'inherit';
            card.appendChild(movesDiv);
            
            card.appendChild(nameDiv);
            card.appendChild(livesDiv);
            card.appendChild(directionDiv);
            
            card.style.backgroundColor = '#87CEEB';
            card.style.display = 'flex';
            card.style.flexDirection = 'column';
            card.style.alignItems = 'center';
            card.style.justifyContent = 'center';
            
            container.appendChild(card);
            occupiedPositions.set(`${row},${col}`, shipCard);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è —Ä—è–¥–æ–º —Å –∫–∞—Ä—Ç–æ–π
        function placeShip(direction) {
            if (shipCard.direction === direction) return;

            // –ù–∞—Ö–æ–¥–∏–º –∫—Ä–∞–π–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            let minRow = 0, maxRow = 0, minCol = 0, maxCol = 0;
            let shipRow, shipCol;

            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –∫–∞—Ä—Ç, –∏—Å–∫–ª—é—á–∞—è –∫–æ—Ä–∞–±–ª—å
            const cardPositions = Array.from(occupiedPositions.entries())
                .filter(([_, card]) => card !== shipCard)
                .map(([pos]) => pos.split(',').map(Number));

            if (cardPositions.length === 0) return;

            // –ù–∞—Ö–æ–¥–∏–º –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—è —Å –∫–∞—Ä—Ç–∞–º–∏
            cardPositions.forEach(([row, col]) => {
                minRow = Math.min(minRow, row);
                maxRow = Math.max(maxRow, row);
                minCol = Math.min(minCol, col);
                maxCol = Math.max(maxCol, col);
            });

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–æ—Ä–∞–±–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            switch(direction) {
                case 'NW':
                    shipRow = minRow - 1;
                    shipCol = minCol - 1;
                    break;
                case 'NE':
                    shipRow = minRow - 1;
                    shipCol = maxCol + 1;
                    break;
                case 'SW':
                    shipRow = maxRow + 1;
                    shipCol = minCol - 1;
                    break;
                case 'SE':
                    shipRow = maxRow + 1;
                    shipCol = maxCol + 1;
                    break;
            }

            createShipCard(shipRow, shipCol);
            shipCard.direction = direction;
            shipCard.position = `${shipRow},${shipCol}`;
            updateHighlights();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è
        function tryMoveShip() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–æ—Ä–∞–±–ª—å –Ω–∞ –ø–æ–ª–µ
            if (!shipCard.position) return;

            // –ï—Å–ª–∏ –∫–æ—Ä–∞–±–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –∏ –≤—ã—Ö–æ–¥–∏–º
            if (shipCard.skipMove) {
                shipCard.skipMove = false;
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ—Å—Ç–∏–≥ –ª–∏ –∫–æ—Ä–∞–±–ª—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞–≥–æ–≤
            if (shipCard.moves >= 4) {
                const gameOverText = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ö–æ—Ä–∞–±–ª—å —Å–æ–≤–µ—Ä—à–∏–ª 4 —à–∞–≥–∞.';
                gameOverDiv.textContent = gameOverText;
                gameOverDiv.style.display = 'block';
                container.style.pointerEvents = 'none';
                return;
            }

            const [oldRow, oldCol] = shipCard.position.split(',').map(Number);
            let newRow = oldRow;
            let newCol = oldCol;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            switch(shipCard.direction) {
                case 'NW':
                    newCol++;
                    break;
                case 'NE':
                    newRow++; 
                    break;
                case 'SW':
                    newRow--;
                    break;
                case 'SE':
                    newCol--;
                    break;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ –∫–æ—Ä–∞–±–ª—å –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –ø–æ–ª—è
            if (newRow < -3 || newRow > 3 || newCol < -3 || newCol > 3) {
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–∞ –ª–∏ –Ω–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
            if (occupiedPositions.has(`${newRow},${newCol}`)) {
                return;
            }

            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —à–∞–≥–æ–≤
            shipCard.moves++;

            // –£–¥–∞–ª—è–µ–º –∫–æ—Ä–∞–±–ª—å —Å–æ —Å—Ç–∞—Ä–æ–π –ø–æ–∑–∏—Ü–∏–∏
            occupiedPositions.delete(shipCard.position);
            const oldCard = document.querySelector(`.card[data-position="${shipCard.position}"]`);
            if (oldCard) oldCard.remove();

            // –†–∞–∑–º–µ—â–∞–µ–º –∫–æ—Ä–∞–±–ª—å –Ω–∞ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
            createShipCard(newRow, newCol);
            shipCard.position = `${newRow},${newCol}`;
            updateHighlights();

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ö–æ–¥–∞
            if (shipCard.moves >= 4) {
                const gameOverText = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ö–æ—Ä–∞–±–ª—å —Å–æ–≤–µ—Ä—à–∏–ª 4 —à–∞–≥–∞.';
                gameOverDiv.textContent = gameOverText;
                gameOverDiv.style.display = 'block';
                container.style.pointerEvents = 'none';
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        function addCard(row, col) {
            const coords = polarToCartesian(row, col);
            const card = document.createElement('div');
            card.className = 'card';
            card.setAttribute('data-position', `${row},${col}`);
            card.style.left = coords.x + 'px';
            card.style.top = coords.y + 'px';
            
            const cardObj = deck[16 - cards];
            
            const livesDiv = document.createElement('div');
            livesDiv.textContent = cardObj.lives;
            livesDiv.style.fontSize = '24px';
            
            const directionDiv = document.createElement('div');
            directionDiv.textContent = cardObj.direction;
            directionDiv.style.fontSize = '14px';
            directionDiv.style.marginTop = '2px';
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –µ—â–µ –Ω–µ —Ä–∞–∑–º–µ—â–µ–Ω –Ω–∏ –æ–¥–∏–Ω –∫–æ—Ä–∞–±–ª—å, —Ä–∞–∑–º–µ—â–∞–µ–º –∫–æ—Ä–∞–±–ª—å
            if (cardObj.direction && ['NW', 'NE', 'SW', 'SE'].includes(cardObj.direction) && !shipCard.direction) {
                placeShip(cardObj.direction);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            if (cardObj.id && cardObj.id !== '') {
                const nameDiv = document.createElement('div');
                nameDiv.textContent = cardObj.id;
                nameDiv.style.fontSize = '12px';
                nameDiv.style.marginTop = '2px';
                nameDiv.style.fontStyle = 'italic';
                card.appendChild(nameDiv);
            }
            
            card.appendChild(livesDiv);
            card.appendChild(directionDiv);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è
            const colors = ['#FFB3BA', '#BAFFC9', '#BAE1FF', '#FFFFBA'];
            card.style.backgroundColor = colors[cardObj.lives];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            card.style.display = 'flex';
            card.style.flexDirection = 'column';
            card.style.alignItems = 'center';
            card.style.justifyContent = 'center';
            
            container.appendChild(card);
            
            occupiedPositions.set(`${row},${col}`, cardObj);
            updateHighlights(); // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç—ã
            updateGameState();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
        function updateHighlights() {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É
            document.querySelectorAll('.highlight').forEach(el => el.remove());

            occupiedPositions.forEach((card, pos) => {
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –≤–æ–∫—Ä—É–≥ –∫–æ—Ä–∞–±–ª—è
                if (card === shipCard) return;

                const [row, col] = pos.split(',').map(Number);
                
                const directions = [
                    {dr: 0, dc: -1}, // left
                    {dr: 0, dc: 1},  // right
                    {dr: -1, dc: 0}, // top
                    {dr: 1, dc: 0}   // bottom
                ];

                directions.forEach(({dr, dc}) => {
                    const newRow = row + dr;
                    const newCol = col + dc;
                    
                    if (isValidPosition(newRow, newCol)) {
                        const coords = polarToCartesian(newRow, newCol);
                        const highlight = document.createElement('div');
                        highlight.className = 'highlight';
                        highlight.style.left = coords.x + 'px';
                        highlight.style.top = coords.y + 'px';
                        
                        highlight.addEventListener('click', () => {
                            if (lives > 0 && cards > 0) placeCard(newRow, newCol);
                        });
                        
                        container.appendChild(highlight);
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞—Ä—Ç –≤ —Ä—è–¥—É/–∫–æ–ª–æ–Ω–∫–µ
        function hasMaxRowsOrColumns(row, col) {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏, –∏—Å–∫–ª—é—á–∞—è –∫–æ—Ä–∞–±–ª—å
            const positions = Array.from(occupiedPositions.entries())
                .filter(([_, card]) => card !== shipCard)
                .map(([pos]) => pos.split(',').map(Number));
            positions.push([row, col]);
            
            const uniqueRows = [...new Set(positions.map(pos => pos[0]))];
            const uniqueCols = [...new Set(positions.map(pos => pos[1]))];
            
            return uniqueRows.length <= 4 && uniqueCols.length <= 4;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏
        function isValidPosition(row, col) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—è (4x4)
            if (row < -3 || row > 3 || col < -3 || col > 3) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–∞ –ª–∏ –ø–æ–∑–∏—Ü–∏—è
            if (occupiedPositions.has(`${row},${col}`)) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç –≤ —Ä—è–¥—É/–∫–æ–ª–æ–Ω–∫–µ
            if (!hasMaxRowsOrColumns(row, col)) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–∑–∏—Ü–∏—è —É–≥–ª–æ–≤–æ–π
            if (Math.abs(row) === 3 && Math.abs(col) === 3) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –∫–æ—Ä–∞–±–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            if (shipCard.direction) {
                // –ù–∞—Ö–æ–¥–∏–º –∫—Ä–∞–π–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
                let minRow = 3, maxRow = -3, minCol = 3, maxCol = -3;
                occupiedPositions.forEach((card, pos) => {
                    if (card.id === 'ship') return;

                    const [cardRow, cardCol] = pos.split(',').map(Number);
                    minRow = Math.min(minRow, cardRow);
                    maxRow = Math.max(maxRow, cardRow);
                    minCol = Math.min(minCol, cardCol);
                    maxCol = Math.max(maxCol, cardCol);
                });

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                switch(shipCard.direction) {
                    case 'NE': // –ù–µ–ª—å–∑—è –≤—ã—à–µ –∏ –ø—Ä–∞–≤–µ–µ
                        if (row < minRow || col > maxCol) return false;
                        break;
                    case 'SE': // –ù–µ–ª—å–∑—è –Ω–∏–∂–µ –∏ –ø—Ä–∞–≤–µ–µ
                        if (row > maxRow || col > maxCol) return false;
                        break;
                    case 'SW': // –ù–µ–ª—å–∑—è –Ω–∏–∂–µ –∏ –ª–µ–≤–µ–µ
                        if (row > maxRow || col < minCol) return false;
                        break;
                    case 'NW': // –ù–µ–ª—å–∑—è –≤—ã—à–µ –∏ –ª–µ–≤–µ–µ
                        if (row < minRow || col < minCol) return false;
                        break;
                }
            }
            
            return true;
        }

        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
        function placeCard(row, col) {
            // –ù–∞ –∫–∞–∂–¥—ã–π —Ö–æ–¥:
            // 1. –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç—É (—Ç–∞–∫–∂–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç –≤ –∫–æ–ª–æ–¥–µ)
            const cardObj = deck[16 - cards];
            lives = lives + cardObj.lives;
            cards--;
            cardsCounter.textContent = cards;
            
            addCard(row, col);

            // 2. –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–µ–π
            decreaseLives();

            // 3. –°–¥–≤–∏–≥–∞–µ–º –∫–æ—Ä–∞–±–ª—å
            tryMoveShip();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
            updateHighlights();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
            if (lives <= 0 || cards <= 0 || shipCard.moves >= 4) {
                let gameOverText;
                if (lives <= 0) {
                    gameOverText = `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∂–∏–∑–Ω–∏. –í—ã–ª–æ–∂–µ–Ω–æ –∫–∞—Ä—Ç: ${17 - cards}`;
                } else if (cards <= 0) {
                    gameOverText = `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∫–∞—Ä—Ç—ã. –û—Å—Ç–∞–ª–æ—Å—å –∂–∏–∑–Ω–µ–π: ${lives}`;
                } else {
                    gameOverText = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ö–æ—Ä–∞–±–ª—å —Å–æ–≤–µ—Ä—à–∏–ª 4 —à–∞–≥–∞.';
                }
                gameOverDiv.textContent = gameOverText;
                gameOverDiv.style.display = 'block';
                container.style.pointerEvents = 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∂–∏–∑–Ω–µ–π
        function decreaseLives() {
            lives = lives - 1;
            livesCounter.textContent = lives;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function updateGameState() {
            livesCounter.style.color = lives <= 5 ? 'red' : 'inherit';
            cardsCounter.style.color = cards <= 5 ? 'red' : 'inherit';
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        init();
    </script>
</body>
</html>
